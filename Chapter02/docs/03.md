# 3. 개발자를 위한 테스팅 프레임워크 JUnit

## 3.1 JUnit 테스트 실행 방법

- JUnit 테스트 실행 방법은 자바 IDE에 내장된 JUnit 테스트 지원 도구를 사용하는 것이다.

### IDE

- @Test가 들어 있는 테스트 클래스를 선택한 뒤 실행하면 main() 메서드가 없이도 실행된다.
- 결과를 나타내는 창이 있어, 수행시간, 실행한 테스트 수, 테스트 에러의 수, 테스트 실패의 수를 확인할 수 있다.

### 빌드 툴

- 프로젝트 빌드를 위해 ANT나 Maven 같은 빌드 툴과 스크립트를 사용하고 있다면, 빌드 툴이 제공하는 JUnit 플러그인이나 태스크를 이용하여 테스트를 실행할 수 있다.


## 3.2 테스트 결과의 일관성

- UserDaoTest 테스트를 실행 하기 전에 DB의 USER 테이블 데이터를 모두 삭제해줘야 하는 점이 불편했다.
- 테스트를 반복적으로 테스트 했을 때 성공하기도 실패하기도 한다면 좋은 테스트가 아니다.
- 코드에 변경사항이 없다면 항상 좋은 결과를 내야 한다.
- UserDaoTest의 문제는 이전 테스트로 인해 DB에 중복된 데이터가 있을 수 있다는 점이다.
- 테스트를 마치면 이 정보를 삭제해서 테스트를 수행하기 이전 상태로 만들어주는 것이 좋다.

### deleteAll()의 getCount() 추가

- UserDao에 새로운 기능을 추가한다.
    - deleteAll()
    - getCount()

```
public void deleteAll() throws SQLException, ClassNotFoundException {
    Connection c = dataSource.getConnection();

    PreparedStatement ps = c.prepareStatement("DELETE FROM users");
    ps.execute();

    ps.close();
    c.close();
}

public int getCount() throws Exception {
    Connection c = dataSource.getConnection();

    PreparedStatement ps = c.prepareStatement("SELECT COUNT(*) FROM users");
    ResultSet rs = ps.executeQuery();
    rs.next();
    int count = rs.getInt(1);

    rs.close();
    ps.close();
    c.close();

    return count;
}
```

### deleteAll()과 getCount()의 테스트

- 기능을 추가했으니 테스트를 만들어야 한다.
- 두 가지 메서드는 독립적으로 자동 실행되는 테스트를 만들기가 애매하다.
- 따라서 기존 addAndGet() 테스트를 확장하기로 한다.
    - addAndGet()이 실행되기 전에 deleteAll()을 실행하기로 한다.
- deleteAll() 자체를 검증하진 않았으므로, getCount()를 활용해 본다.
- deleteAll() 이후 getCount()를 실행하면 0이 나와야 한다.
- getCount() 역시 검증을 해야 한다.
    - add()를 수행하고 나서 0에서 1로 변하는지 확인하면 된다.

```
@Test
public void addAndGet() throws SQLException {
    // ...

    dao.deleteAll();
    assertThat(dao.getCount(), is(0));

    // ...

    dao.add(user);
    assertThat(dao.getCount(), is(1));

    // ...
}
```

### 동일한 결과를 보장하는 테스트

- 테스트는 성공적이고 여러 번 실행해도 문제가 없다.

---
[목록](./index.md)
