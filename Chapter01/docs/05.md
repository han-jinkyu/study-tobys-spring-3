# 5. 스프링의 IoC

- 스프링의 핵심은 빈 팩토리 또는 애플리케이션 컨텍스트라 불리는 것이다.
- DaoFactory가 하는 일을 좀 더 일반화한 것이다.

## 5.1 오브젝트 팩토리를 이용한 스프링 IoC

### 애플리케이션 컨텍스트와 정보

- `빈(Bean)`: 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트.
- 보통 빈 팩토리보다 좀 더 확장한 애플리케이션 컨텍스트(application context)를 주로 사용한다.
- 애플리케이션 팩토리는 IoC 방식을 따라 만들어진 일종의 빈 팩토리다.
- 애플리케이션 팩토리는 별도의 정보를 참고해서 빈의 생성, 관계설정 등의 제어 작업을 총괄한다.

### DaoFactory를 사용하는 애플리케이션 컨텍스트

- DaoFactory를 스프링의 빈 팩토리가 사용할 수 있는 본격적인 설정정보로 만들어 본다.
- 먼저 스프링이 빈 팩토리를 위한 오브젝트 설정을 담당하는 클래스라고 인식할 수 있게 `@Configuration` 애노테이션을 추가한다.
- 오브젝트를 만들어주는 메서드에는 `@Bean`이라는 애노테이션을 추가한다.
- DaoFactory는 이제 XML과 같은 `스프링 전용 설정 정보`가 되었다.

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class DaoFactory {

    @Bean
    public UserDao userDao() {
        return new UserDao(connectionMaker());
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new AConnectionMaker();
    }
}
```

- 이제 DaoFactory를 설정정보로 사용하는 애플리케이션 컨텍스트를 만들어 본다.
- 애플리케이션 컨텍스트는 `ApplicationContext 타입의 오브젝트`다.
- 여러 종류가 존재하지만 애노테이션을 사용하려면 `@AnnocationApplicationContext`를 사용한다.
- 만들 때는 DaoFactory 클래스를 생성자에 넘겨 준다.

```java
public class UserDaoTest {

    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        ApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
        UserDao dao = context.getBean("userDao", UserDao.class);
        // ...
    }
}
```

- `getBean() 메서드`는 ApplicationContext가 관리하는 오브젝트를 요청하는 메서드다.
- DaoFactory에서 @Bean을 userDao()에 추가했는데, 이 메서드 이름이 빈의 이름이 된다.
- 이름을 사용해서 가져오는 이유는 UserDao를 생성하는 방식이나 구성을 다양하게 할 수 있기 때문이다.
- `getBean()`은 Object 타입을 반환하기 때문에 캐스팅을 해야 된다. 하지만 제네릭이 도입되어 두 번째 파라미터에 리턴 타입을 주면 캐스팅되어 반환된다.

---
[목록](./index.md)
