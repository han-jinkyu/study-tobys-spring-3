# 6. 싱글톤 레지스트리와 오브젝트 스코프

- 지금까지의 내용만 보면 DaoFactory와 @Configuration 애노테이션을 추가해서 스프링의 애플리케이션 컨텍스트를 통해 사용하는 것은 동일해 보인다.
- 하지만 스프링 애플리케이션 컨텍스트는 기존에 직접 만들었던 오브젝트 팩토리와는 중요한 차이점이 있다.
    - DaoFactory의 userDao() 메서드를 여러 번 호출할 때 오브젝트는 서로 다르다.
    - 애플리케이션 컨텍스트를 이요하여 DaoFactory를 설정 정보로 등록한 뒤 getBean() 메서드를 이용해 가져오는 오브젝트는 `동일`하다. 

## 6.1 싱글톤 레지스트리로서의 애플리케이션 컨텍스트

- 애플리케이션 컨텍스트는 우리가 만든 오브젝트 팩토리와 유사하게 동작한다.
- 그와 동시에 싱글톤을 저장하고 관리하는 `싱글톤 레지스트리(singleton registry)`다.
    - 즉 별다른 설정을 하지 않으면 내부에서 생성하는 빈 오브젝트를 모두 싱글톤으로 만든다.

### 서버 애플리케이션과 싱글톤

- 싱글톤으로 빈을 만드는 이유는 '스프링이 주로 적용되는 대상이 자바 엔터프라이즈 기술'을 사용하는 서버 환경이기 때문이다.
- 대규모인 엔터프라이즈 서버환경에서 매번 오브젝트를 만들어서 사용한다면 GC에 부하가 걸린다.
- 그래서 엔터프라이즈 분야에서는 `서비스 오브젝트`라는 개념을 일찍부터 사용해왔다.
    - 서블릿은 대부분 멀티스레드 환경에서 싱글톤으로 동작한다.
    - 서블릿 클래스당 하나의 오브젝트만 만들어두고 사용자의 요청을 담당하는 여러 스레드에서 공유한다.
- 디자인 패턴에서 소개된 싱글턴 패턴은 사용하기 까다롭고 여러 문제점이 있다.
    - 싱글턴 패턴 중 피해야 할 `안티 패턴(anti pattern)`이 존재하기도 한다.

### 싱글톤 패턴의 한계

일반적인 싱글톤 패턴 구현 방식에는 다음과 같은 문제가 있다.

- private 생성자를 갖고 있기 때문에 상속할 수 없다.
- 싱글톤은 테스트하기가 힘들다.
- 서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다.
- 싱글톤의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다.

### 싱글톤 레지스트리

- 자바의 기본적 싱글톤 구현은 단점이 존재하므로 스프링은 직접 싱글톤 형태의 오브젝트를 만들고 관리한다.
    - 이를 `싱글톤 레지스트리(singleton registry)`라 한다.
- 스프링 컨테이너는 싱글톤을 생성하고 관리하고 공금하는 `싱글톤 관리 컨테이너`이기도 하다.
- `싱글톤 레지스트리`의 장점은 평범한 자바 클래스를 싱글톤으로 활용하게 해준다는 점이다.
- 덕분에 테스트 환경에서 자유롭게 오브젝트를 만들 수 있고, 목 오브젝트로 대체하는 것도 간단하다.
- 스프링은 `IoC 컨테이너`일 뿐 아니라 `싱글톤 레지스트리`다.

---
[목록](./index.md)
