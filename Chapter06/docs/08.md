# 8. 트랜잭션 지원 테스트

## 8.1 선언적 트랜잭션과 트랜잭션 전파 속성

- 트랜잭션을 정의할 때 지정할 수 있는 트랜잭션 전파 속성은 매우 유용한 개념이다.
- 예를 들어 `REQUIRED`로 전파 속성을 지정해줄 경우, 앞에서 진행 중인 트랜잭션이 있으면 참여하고 없으면 자동으로 새로 시작해준다.
- `REQUIRED` 전파 속성을 가진 메서드를 결합해서 다양한 크기의 트랜잭션 작업을 만들 수 있으며, 트랜잭션 적용 때문에 불필요한 코드를 중복하는 것도 피할 수 있고, 애플리케이션을 작은 기능 단위로 쪼개서 개발할 수 있다.
- `UserService::add()`의 경우 전파 방식은 `REQUIRED`며, 이 메서드가 처음 호출되는 서비스 계층의 메서드라면 한 명의 사용자를 등록하는 것이 하나의 비즈니스 작업 단위가 된다. DB 트랜잭션은 단위 업무와 일치해야 한다.
- 하지만 작업 단위가 다른 비즈니스 로직이 있을 수 있다. 예를 들어 그날의 이벤트 신청 내역을 모아서 한 번에 처리하는 기능 중 회원가입을 원하는 신청서에 대해 유저를 등록해야 한다고 하면, 직접 `UserDao::add()`를 호출할 수도 있으나 `UserService::add()`를 이용할 수도 있다.
- 이런 경우 `UserService::add()`를 이용해 사용자 등록 중 처리해야 할, 디폴트 레벨 설정과 같은 로직을 적용하는 것이 바람직하다. 그럼 `UserService::add()`는 독자적인 트랜잭션을 사용하는 대신 이벤스 신청 내역 처리 메서드에서 시작된 트랜잭션의 일부로 참여하게 된다.
- 덕분에 독자적인 트랜잭션이 발생하지 않으며 `add()` 메서드를 그대로 복사해서 넣는 등의 코드 중복이 발생할 여지를 줄여준다.
- `AOP`를 이용해 코드 외부에서 트랜잭션 기능을 부여하고 속성을 지정할 수 있게 해주는 방법을 `선언적 트랜잭션(declarative transaction)`이라 한다.
- 반대로 `TransactionTemplate`이나 개별 데이터 기술의 트랜잭션 API를 사용해 직접 코드 안에서 사용하는 방법은 `프로그램에 의한 트랜잭션(programmatic transaction)`이라 한다.

---
[목록](./index.md)
