# 6. 트랜잭션 속성

- `DefaultTransactionDefinition`의 용도를 살펴본다.

## 6.1 트랜잭션 정의

- `TransactionDefinition` 인터페이스는 트랜잭션의 동작방식에 영향을 줄 수 있는 네 가지 속성을 정의하고 있다.

### 트랜잭션 전파

- `트랜잭션 전파(transaction propagation)`란 트랜잭션의 경계에서 이미 진행 중인 트랜잭션이 있을 때 어떻게 동작할 것인가를 결정하는 방식을 말한다.
- 만약 A 트랜잭션이 시작되고 끝나지 않은 시점에 B 트랜잭션이 호출된다면 B의 코드는 어떤 트랜잭션 안에서 동작할 것인가?
- 대표적으로 다음과 같은 트랜잭션 전파 속성을 줄 수 있다.
    - `PROPAGATION_REQUIRED`: 가장 많이 사용되는 전파 속성. 진행 중인 트랜잭션이 없으면 새로 시작하고, 있다면 이에 참여한다. `DefaultTransactionDefinition`의 전파 속성이 이에 해당한다.
    - `PROPAGATION_REQUIRES_NEW`: 항상 새로운 트랜잭션을 시작한다.
    - `PROPAGATION_NOT_SUPPORTED`: 트랜잭션 없이 동작하도록 만들 수 있다. 진행 중인 트랜잭션이 있어도 무시한다. 이는 복잡한 포인트컷을 만드는 것보다 간단하게 트랜잭션을 제외할 때 사용한다. 
- `getTransaction()` 메서드를 사용하는 이유는 트랜잭션 전파 속성을 가지고 특정 상황에 맞는 트랜잭션을 이용하기 위해서다.

### 격리수준

- 모든 DB 트랜잭션은 `격리수준(isolation level)`을 갖고 있어야 한다.
- 적절한 격리 수준으로 가능한 한 많은 트랜잭션을 동시에 진행하기 위해서다.
- `DefaultTransactionDefinition`에 설정된 격리수준은 `ISOLATION_DEFAULT`다. 이는 `DataSource`에 설정되어 있는 디폴트 격리수준을 그대로 따른다는 뜻이다.

### 제한시간

- 트랜잭션을 수행하는 `제한시간(timeout)`을 설정할 수 있다.
- `DefaultTransactionDefinition`의 기본 설정은 제한시간이 없는 것이다.
- 제한시간은 트랜잭션을 직접 시작할 수 있는 `PROPAGATION_REQUIRED`나 `PROPAGATION_REQUIRES_NEW`와 함께 사용해야만 의미가 있다.

### 읽기전용

- `읽기전용(read only)`으로 설정하면 트랜잭션 내에서 데이터를 조작하는 시도를 막아줄 수 있고, 데이터 액세스 기술에 따라서 성능이 향상될 수 있다.
- `TransactionDefinition` 타입 오브젝트를 사용하려면 네 가지 속성을 이용해 트랜잭션의 동작방식을 제어할 수 있다.
- 트랜잭션 정의를 수정하려면 트랜잭션 경계를 설정하는 `TransactionAdvice`에 `TransactionDefinition` 오브젝트를 DI 받아서 사용하도록 변경하면 된다.

---
[목록](./index.md)
